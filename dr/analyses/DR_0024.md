# DR_0024

- span: L11810-L12147
- sha256: 4fc987112793e0ec4ca2d0c8ba7885bffbbabdbd6c2827c324f691e1f837fe52
- tags: security, integration, testing, ui
- importance: M

## Что утверждается
### Primary findings
> ### TL;DR  
> *Я физически не могу «нажать кнопку» `git push` изнутри ChatGPT — у меня нет интерактивного шелла и сетевого выхода к GitHub.  
> Зато я дал тебе **полный набор патчей, файлов и готовый шаблон PR**. Ниже — пошаговые команды, которыми ты (или CI) создаёшь ветку и Pull Request за 30 секунд.*
> 
> ---
> 
> ## Почему ChatGPT не пушит сам
> - **Нет реального git-клиента.** Сервер, на котором работает ChatGPT, не выдаёт мне интерактивный терминал, чтобы выполнить `git push` или `gh pr create`.  
> - **Безопасность GitHub.** Даже при `write`-токене GitHub требует настоящего SSH/HTTPS сеанса; модель не может открывать такие соединения напрямую.  
> - **Политика платформы.** Мне разрешено генерировать контент (patch-файлы, markdown, YAML), но не выполнять сетевые побочные эффекты (push в ваш репозиторий).  
> 
> *Итого: я могу «собрать» PR-пакет, но нажать «Create PR» должен любой процесс с реальным git-доступом — ты, GitHub CLI или GitHub Action.* citeturn0search3turn0search4
> 
> ---
> 
> ## Как сделать PR в 3 команды
> 
> ```bash
> # 1️⃣ Клонируешь либо переходишь в локальный репозиторий
> git checkout -b o3/roadmap/2025-07-22-draft master
> 
> # 2️⃣ Сохраняешь мои patch-файлы, либо копируешь каталоги bot/, core/, config/, .github/
> # (если используешь *.patch, то:)
> git apply 00-roadmap-S0-S6.patch
> git add .
> git commit -m "Roadmap S0–S6 implementation [SAFE MERGE]"
> 
> # 3️⃣ Публикуешь ветку и создаёшь PR одной командой GitHub CLI
> git push -u origin o3/roadmap/2025-07-22-draft
> gh pr create \
>    --base master \
>    --head o3/roadmap/2025-07-22-draft \
>    --title "[SAFE MERGE] Roadmap S0–S6" \
>    --body-file pr_description.md
> ```
> - `gh pr create` автоматически откроет Pull Request и выведет URL citeturn0search0turn0search1  
> - **pr_description.md** — это сгенерированное мной описание (чек-листы, ссылки, теги). Просто скопируй его содержимое.  
> 
> > *Нет GH CLI?* - Установи: `brew install gh` (macOS), `sudo apt install gh` (Ubuntu) и сделай `gh auth login` citeturn0search2  
> 
> ---
> 
> ## Если нужен полностью автоматический шаг
> 
> 1. **GitHub Action**: добавь job вроде
> 
> ```yaml
> - name: Create PR automatically
>   run: gh pr create -B master -H o3/roadmap/2025-07-22-draft \
>         --title "[SAFE MERGE] Roadmap S0–S6" \
>         --body-file pr_description.md
>   env:
>     GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
> ```
> 2. Дай workflow-runner права `contents: write`.  
> 3. Action сам откроет PR при пуше ветки citeturn0search7  
> 
> ---
> 
> ## Что уже готово
> 
> | Файл/директория | Содержит | Фаза |
> |-----------------|----------|------|
> | `core/schema_validator.py` | валидация сумм, кошельков | S0 |
> | `config/aggregators.yml`   | список агрегаторов + шаблоны deeplink | S3 |
> | `config/weights.yml`       | веса для скоринга | S3 |
> | `.github/workflows/ci.yml` | линтер + pytest + coverage | S4 |
> | `bot/…` патчи              | FSM + fail-closed + UX | S0–S2 |
> | `pr_description.md`        | готовое описание PR | итог |
> 
> Патчи и новые файлы лежат в ответе «Этап 7» — просто сохраните их в репозиторий перед шагом 2.  
> 
> ---
> 
> ## Дальнейшие шаги (forward-thinking)
> 
> - **После merge**: настроить `gh pr merge --squash --auto` в CI, чтобы PR с тегом `[SAFE MERGE]` автоматически схлапывался после успешных тестов.  
> - **Автопубликация**: следующий релиз можно оформить GitHub Action-ом `release-please`, чтобы теги и ченджлоги генерировались из PR-описаний.  
> - **Бэкенд-мока**: для e2e-тестов добавить wiremock-стаб на внешнее API агрегатора, чтобы pipeline оставался детерминированным.
> 
> ---
> 
> *Теперь у тебя есть полный пакет — остаётся прогнать 3 команды (или запустить Action), и PR появится в репозитории. Если нужно, могу сгенерировать `00-roadmap-S0-S6.patch` и `pr_description.md` одним файлом — скажи, и пришлю.*
> 
> Respond in Russian

### Secondary findings
- None

## Что менять в репо
- core/
- integrations/
- static/
- templates/
- tests/

## DoD
- HTTP 200 from integration endpoints
- UX review accepted
- pytest -q passes
- vulnerability scan clean

## Risks
- API rate limits
- data breaches
- flaky tests
- misconfigured auth
- third-party downtime
